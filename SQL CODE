Teams table
-- Primary table for all teams.
CREATE TABLE teams (
    team_id UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- Use UUID for unique IDs
    team_name VARCHAR(100) NOT NULL UNIQUE
);

-- Users table
-- The password_hash uses TEXT, which is suitable for storing a hashed password
-- of variable length. A CHECK constraint ensures roles are valid.
CREATE TABLE users (
    user_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) NOT NULL UNIQUE,
    password_hash TEXT NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('employer', 'employee')),
    team_id UUID REFERENCES teams(team_id) ON DELETE SET NULL
);

-- Goals table (assigned by employer to employee)
-- Tracks goals and their status.
CREATE TABLE goals (
    goal_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    employer_id UUID NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    employee_id UUID NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    goal_title VARCHAR(255) NOT NULL,
    goal_description TEXT,
    due_date DATE,
    status VARCHAR(50) NOT NULL DEFAULT 'Not Started' CHECK (status IN ('Not Started', 'In Progress', 'Completed', 'Canceled')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tasks table (linked to goals)
-- Tracks individual tasks for a given goal.
CREATE TABLE tasks (
    task_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    goal_id UUID NOT NULL REFERENCES goals(goal_id) ON DELETE CASCADE,
    task_description TEXT NOT NULL,
    status VARCHAR(50) NOT NULL DEFAULT 'To Do' CHECK (status IN ('To Do', 'In Progress', 'Done')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Private Evaluations (viewable only by employers)
-- Stores performance evaluations.
CREATE TABLE evaluations (
    evaluation_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    employer_id UUID NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    employee_id UUID NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    evaluation_date DATE NOT NULL,
    rating INTEGER CHECK (rating BETWEEN 1 AND 5),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
